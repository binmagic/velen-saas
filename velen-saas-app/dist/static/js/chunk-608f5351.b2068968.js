(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-608f5351"],{"09f4":function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),Math.easeInOutQuad=function(t,e,n,a){return t/=a/2,t<1?n/2*t*t+e:(t--,-n/2*(t*(t-2)-1)+e)};var a=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)}}();function o(t){document.documentElement.scrollTop=t,document.body.parentNode.scrollTop=t,document.body.scrollTop=t}function r(){return document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop}function s(t,e,n){var s=r(),i=t-s,c=20,u=0;e="undefined"===typeof e?500:e;var l=function t(){u+=c;var r=Math.easeInOutQuad(u,s,i,e);o(r),u<e?a(t):n&&"function"===typeof n&&n()};l()}},"52d7":function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var a=n("b775");function o(t){return Object(a["a"])({url:"/query/report",method:"post",data:t})}},"7d99":function(t,e,n){"use strict";n.d(e,"e",(function(){return o})),n.d(e,"b",(function(){return r})),n.d(e,"f",(function(){return s})),n.d(e,"c",(function(){return i})),n.d(e,"g",(function(){return c})),n.d(e,"h",(function(){return u})),n.d(e,"d",(function(){return l})),n.d(e,"a",(function(){return d}));var a=n("b775");function o(t){return Object(a["a"])({url:"/metadata/event",method:"get",params:t})}function r(t){return Object(a["a"])({url:"/metadata/event",method:"post",data:t})}function s(t){return Object(a["a"])({url:"/metadata/event/prop",method:"get",params:t})}function i(t){return Object(a["a"])({url:"/metadata/event/prop",method:"post",data:t})}function c(t){return Object(a["a"])({url:"/metadata/event",method:"put",data:t})}function u(t){return Object(a["a"])({url:"/metadata/event/prop",method:"put",data:t})}function l(t){return Object(a["a"])({url:"/metadata/event/prop/".concat(t),method:"delete"})}function d(){return Object(a["a"])({url:"/metadata/all",method:"get"})}},9406:function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"app-container"},[n("custom-header",{attrs:{"show-name":t.$route.meta.title}},[n("div",{attrs:{slot:"tools"},slot:"tools"},[t.componentFlag.enableDatePick?n("div",{staticStyle:{"margin-right":"40px","align-self":"center",display:"flex"}},[n("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":t.componentOption.datePickerOptions},model:{value:t.query.dateRange,callback:function(e){t.$set(t.query,"dateRange",e)},expression:"query.dateRange"}}),t._v(" "),n("i",{staticClass:"el-icon-close",staticStyle:{"align-self":"center","margin-left":"20px"},on:{click:function(e){t.componentFlag.enableDatePick=!1}}})],1):n("el-button",{staticStyle:{"margin-right":"20px"},attrs:{icon:"el-icon-date"},on:{click:function(e){t.componentFlag.enableDatePick=!0}}}),t._v(" "),n("el-button-group",[n("el-button",{attrs:{icon:"el-icon-refresh-left"},on:{click:t.fetchBookmarksData}}),t._v(" "),n("el-button",{attrs:{icon:"el-icon-share"}}),t._v(" "),n("el-button",{attrs:{icon:"el-icon-more"}})],1),t._v(" "),n("el-dropdown",{attrs:{trigger:"click"},on:{command:t.handleClickPlus,"visible-change":t.handleClickPlusVisible}},[n("span",[n("el-button",{staticStyle:{"margin-left":"20px"},attrs:{icon:"el-icon-plus",type:"success"}})],1),t._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",{attrs:{icon:"el-icon-arrow-right",command:"createFromBookmarks"}},[t._v("从书签添加")]),t._v(" "),n("el-dropdown-item",{attrs:{command:"createComponent"}},[t._v("新建组件")]),t._v(" "),n("el-dropdown-item",[t._v("新建描述")])],1)],1)],1)]),t._v(" "),n("el-popover",{ref:"createBookmarksPopover",staticClass:"createBookmarks",attrs:{placement:"bottom-start",width:"200",trigger:"manual"},model:{value:t.componentFlag.enableCreateFromBookmarks,callback:function(e){t.$set(t.componentFlag,"enableCreateFromBookmarks",e)},expression:"componentFlag.enableCreateFromBookmarks"}},[n("el-menu",{on:{select:t.handleSelectBookmarks}},t._l(t.pre_data.bookmarks,(function(e,a){return n("el-menu-item-group",[n("template",{slot:"title"},[t._v(t._s(a))]),t._v(" "),t._l(e,(function(e){return n("el-menu-item",{attrs:{index:e.id}},[t._v(t._s(e.name))])}))],2)})),1)],1),t._v(" "),n("div",{staticClass:"component"},t._l(t.pre_data.dashboard.items,(function(e,a){return n("meta-event-analytics",{ref:a,refInFor:!0,attrs:{bookmarks:t.getBookmarks(a),config:e,meta_props:t.pre_data.meta_props,meta_events:t.pre_data.meta_events,"v-if":"/meta_event_analytics/"==t.getBookmarks(a).type}})})),1),t._v(" "),n("el-dialog",{attrs:{title:"新建组件",visible:t.componentFlag.enableCreateComponent,width:"30%",center:""},on:{"update:visible":function(e){return t.$set(t.componentFlag,"enableCreateComponent",e)}}},[n("el-row",[n("el-col",{attrs:{span:8}},[n("el-card",{attrs:{shadow:"hover"},nativeOn:{click:function(e){return t.jump("menu-analyze-meta-event")}}},[t._v("\n          元数据分析\n        ")])],1)],1)],1),t._v(" "),n("router-view")],1)},o=[],r=(n("db97"),n("5530")),s=(n("7f7f"),n("96cf"),n("1da1")),i=n("bc5d"),c=n("2f62"),u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("card",[n("template",{slot:"title"},[t._v(t._s(t.event_name))]),t._v(" "),n("template",{slot:"tools"}),t._v(" "),n("template",{slot:"content"},[n("custom-table",{attrs:{columns:t.columns,value:t.data,loading:t.loading,total:t.total},on:{"update:columns":function(e){t.columns=e},"update:value":function(e){t.data=e},fetch:t.fetch}})],1)],2)},l=[],d=n("2b74"),m=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("el-card",{staticClass:"box-card small_card"},[n("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t._t("title"),t._v(" "),t._t("tools"),t._v(" "),n("el-dropdown",{staticStyle:{float:"right"}},[n("span",{staticClass:"el-dropdown-link"},[n("i",{staticClass:"el-icon-more-outline el-icon--right"})]),t._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[n("el-dropdown-item",[t._v("小")]),t._v(" "),n("el-dropdown-item",[t._v("中")]),t._v(" "),n("el-dropdown-item",[t._v("大")]),t._v(" "),n("el-dropdown-item",{attrs:{divided:""}},[t._v("设置")]),t._v(" "),n("el-dropdown-item",[t._v("删除")])],1)],1)],2),t._v(" "),t._t("content")],2)},p=[],f={name:"Card"},h=f,v=(n("c7ae"),n("2877")),b=Object(v["a"])(h,m,p,!1,null,null,null),k=b.exports,_=k,g=n("52d7"),w={name:"MetaEventAnalytics",components:{Card:_,CustomTable:d["a"]},props:{meta_props:{type:Array,default:function(){return[]}},meta_events:{type:Array,default:function(){return[]}},bookmarks:{type:Object,default:function(){return{}}},config:{type:String,default:function(){return{}}}},data:function(){return{columns:[],event_id:"",event_name:"",data:[],total:0,loading:!1}},mounted:function(){this.handleData(),this.handleColumns()},methods:{handleData:function(){var t=JSON.parse(this.bookmarks.data);this.event_id=t.measures.eventName,this.event_name=this.getMetaEvent(this.event_id).showName},getMetaEvent:function(t){for(var e in this.meta_events){var n=this.meta_events[e];if(Object.is(t,n.id))return n}},handleColumns:function(){console.log("handleColumns"),this.columns.length=0;var t=this.getMetaEvent(this.event_id);for(var e in t.propIds){var n=t.propIds[e],a=this.meta_props[n];a&&this.columns.push({prop:a.name.toLowerCase(),label:a.showName})}},fetch:function(t){var e=this,n=this;this.loading=!0;var a=JSON.parse(this.bookmarks.data);a.measures=Object.assign({},a.measures,t||{}),Object(g["a"])(a).then((function(t){setTimeout((function(){n.loading=!1}),1e3);var a=[];for(var o in t.rows){var r=t.rows[o],s={};for(var i in r)s[i.toLowerCase()]=r[i];a.push(s)}e.data=a,e.total=t.total||t.rows.length})).catch((function(t){e.loading=!1}))}}},y=w,C=Object(v["a"])(y,u,l,!1,null,null,null),O=C.exports,j=O,F=n("5fd4"),B=n("7d99"),x=n("75fb"),q={name:"Dashboard",components:{CustomHeader:i["a"],MetaEventAnalytics:j},data:function(){return{chartName:"测试",query:{id:"",dateRange:[]},componentOption:{datePickerOptions:{}},componentFlag:{enableDatePick:!1,enableCreateComponent:!1,enableCreateFromBookmarks:!1},pre_data:{bookmarks:{},bookmarksIdMapping:{},dashboards:[],dashboard:{items:[]},meta_props:[],meta_events:[]},save_data:{}}},watch:{$route:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.query.id=this.$route.query.id,t.next=3,this.fetchDashboardInfo();case 3:return t.next=5,this.fetchBookmarksData();case 5:this.$route.meta.title=this.pre_data.dashboard.name;case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},mounted:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.fetchDashboards();case 2:this.query.id=this.$route.query.id,!this.query.id&&this.pre_data.dashboards.length>0&&(this.query.id=this.pre_data.dashboards[0]);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),created:function(){var t=Object(s["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.fetchBookmarks(),t.next=3,this.fetchMetaEventProps();case 3:return t.next=5,this.fetchMetaEvent();case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}(),methods:Object(r["a"])(Object(r["a"])({},Object(c["b"])(["getGroupBookmarks"])),{},{getBookmarks:function(t){return this.pre_data.bookmarksIdMapping[t]},fetchMetaEventProps:function(){var t=this;return new Promise((function(e,n){Object(B["f"])().then((function(n){for(var a in n.items)t.pre_data.meta_props[n.items[a].id]=n.items[a];e()}))}))},fetchMetaEvent:function(){var t=this;return new Promise((function(e,n){Object(B["e"])().then((function(n){t.pre_data.meta_events=n.items,e()}))}))},fetchDashboardInfo:function(){var t=this;return console.log("fetchDashboardInfo"),new Promise((function(e,n){Object(F["c"])(t.query.id).then((function(n){t.pre_data.dashboard=n,e()}))}))},fetchDashboards:function(){return new Promise((function(t,e){t()}))},fetchBookmarks:function(){var t=this;this.getGroupBookmarks().then((function(e){for(var n in console.log("getGroupBookmarks"),t.pre_data.bookmarks=e,t.pre_data.bookmarks)for(var a in t.pre_data.bookmarks[n]){var o=t.pre_data.bookmarks[n][a];t.pre_data.bookmarksIdMapping[o.id]=o}}))},fetchBookmarksData:function(){for(var t in console.log("fetchBookmarksData"),this.pre_data.dashboard.items)this.$refs[t][0].handleData(),this.$refs[t][0].handleColumns(),this.$refs[t][0].fetch()},handleClickPlus:function(t){Object.is(t,"createComponent")?this.componentFlag.enableCreateComponent=!0:Object.is(t,"createFromBookmarks")&&(this.componentFlag.enableCreateFromBookmarks=!0)},handleClickPlusVisible:function(t){t&&(this.componentFlag.enableCreateFromBookmarks=!1)},jump:function(t){this.$router.push({name:t,query:this.$route.query})},handleSelectBookmarks:function(t){var e=this,n=this.pre_data.bookmarksIdMapping[t];this.componentFlag.enableCreateFromBookmarks=!1,this.pre_data.dashboard.items[t]="{}",Object(F["e"])(this.pre_data.dashboard).then((function(t){n.dashboards.push(t.id),Object(x["c"])(n).then((function(t){e.$notify({title:"成功",message:"成功添加到概览",type:"success"})}))}))}})},D=q,P=(n("f8a7"),Object(v["a"])(D,a,o,!1,null,null,null));e["default"]=P.exports},acf4:function(t,e,n){},c7ae:function(t,e,n){"use strict";var a=n("f919"),o=n.n(a);o.a},f8a7:function(t,e,n){"use strict";var a=n("acf4"),o=n.n(a);o.a},f919:function(t,e,n){}}]);