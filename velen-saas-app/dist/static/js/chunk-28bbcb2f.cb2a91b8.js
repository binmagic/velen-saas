(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-28bbcb2f"],{"2dc4":function(t,e,a){t.exports={menuText:"#bfcbd9",menuActiveText:"#409EFF",subMenuActiveText:"#f4f4f5",menuBg:"#304156",menuHover:"#263445",subMenuBg:"#1f2d3d",subMenuHover:"#001528",sideBarWidth:"210px"}},ed63:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("custom-header",{attrs:{"show-name":t.$route.meta.title}},[a("div",{attrs:{slot:"tools"},slot:"tools"},[a("el-popover",{attrs:{placement:"bottom",width:"200",trigger:"click"}},[a("el-button",{attrs:{slot:"reference",icon:"el-icon-folder-add"},slot:"reference"}),t._v(" "),a("el-form",{attrs:{model:t.formData}},[a("el-form-item",{attrs:{label:"书签名"}},[a("el-input",{model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.formData.comment,callback:function(e){t.$set(t.formData,"comment",e)},expression:"formData.comment"}})],1),t._v(" "),a("el-form-item",[a("el-button",[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.submitData}},[t._v("确定")])],1)],1)],1)],1)]),t._v(" "),a("el-container",{staticClass:"main"},[a("el-header",{staticClass:"meta-event-header"},[a("div",{staticStyle:{position:"relative"}},[a("el-row",[a("el-col",{staticStyle:{height:"40px"},attrs:{span:24}},[a("span",[t._v("元事件")]),t._v(" "),a("el-select",{attrs:{size:"small"},on:{change:t.handleSelectEvent},model:{value:t.switchEvent,callback:function(e){t.switchEvent=e},expression:"switchEvent"}},t._l(t.meta_events,(function(t){return a("el-option",{key:t.id,attrs:{label:t.showName,value:t.id}})})),1),t._v(" "),t.filterList.length>=1?a("span",[t._v("的")]):t._e(),t._v(" "),a("el-button",{staticClass:"meta-event-button",attrs:{type:"text",icon:"el-icon-plus"},on:{click:t.handleFilter}},[t._v("筛选条件\n            ")])],1)],1),t._v(" "),a("screening-condition",{attrs:{filter:t.filterList,props:t.meta_props},on:{"update-filter":t.handleUpdate,"get-btn-val":t.handleBtnVal}})],1)]),t._v(" "),a("el-main",[a("el-row",{staticStyle:{display:"flex","align-items":"center"}},[a("el-col",{attrs:{span:8}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.originQuery.dateRange,callback:function(e){t.$set(t.originQuery,"dateRange",e)},expression:"originQuery.dateRange"}})],1),t._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:8}},[a("h4",[t._v(t._s(t.getMetaEventName()))])]),t._v(" "),a("el-col",{attrs:{span:8}})],1),t._v(" "),a("custom-table",{attrs:{columns:t.columns,value:t.data}}),t._v(" "),a("custom-charts",{attrs:{chartName:t.chartName}})],1)],1)],1)},i=[],s=(a("db97"),a("7f7f"),a("7514"),a("2dc4"),a("2b74")),r=a("bc5d"),o=a("1c15"),l=a("b775");function c(t){return Object(l["a"])({url:"/query/meta-event",method:"post",data:t})}var m=a("f670"),u=a("7d99"),f=a("75fb"),h=a("7c5d"),v={components:{CustomTable:s["a"],CustomHeader:r["a"],CustomCharts:o["a"],TagInput:h["a"],ScreeningCondition:m["a"]},data:function(){return{id:"",columns:[],data:[],switchEvent:"",filterValue:"",btnVal:"",filterList:[],meta_events:[],meta_props:{},params:"",query:{},originQuery:{dateRange:[]},formData:{name:"",comment:""},saveData:{data:"",name:"",config:"",type:"/meta_event_analytics/"},chartName:"测试"}},created:function(){this.fetchMetaEventProps(),this.fetchMetaEvent()},methods:{submitData:function(){var t=this,e={};if(this.filterList.length>=1){var a=[];this.filterList.some((function(e){a.push({field:t.meta_events.find((function(a){return t.switchEvent===a.id?t.meta_events.name+"."+e.name:""})),function:e.filter,params:e.params})})),e["condition"]=a,this.filterList.length>1&&(e["relation"]=this.btnVal)}this.saveData.name=this.formData.name,this.saveData.config=JSON.stringify({comment:this.comment}),this.saveData.data=JSON.stringify({measures:this.switchEvent,filter:{},chartsType:"pie",rangeText:"",from_date:"2020-06-08",to_date:"2020-06-09"}),Object(f["b"])(this.saveData).then((function(e){t.id=e.id}))},fetchData:function(){var t=this;c(this.query).then((function(e){t.data=e.items}))},fetchMetaEventProps:function(){var t=this;Object(u["f"])().then((function(e){for(var a in e.items)t.meta_props[e.items[a].id]=e.items[a]}))},fetchMetaEvent:function(){var t=this;Object(u["e"])().then((function(e){t.meta_events=e.items}))},handleSelectEvent:function(){var t=[];for(var e in this.meta_events){var a=this.meta_events[e];if(Object.is(a.id,this.switchEvent)){t=a.propIds;break}}this.handleColumn(t),this.fetchData()},handleColumn:function(t){for(var e in console.log(t),t){var a=this.meta_props[t[e]];this.columns.push({prop:a.name,label:a.showName})}},getMetaEventName:function(){for(var t in this.meta_events){var e=this.meta_events[t];if(Object.is(e.id,this.switchEvent))return e.showName}},handleInput:function(t){},handleSelectChange:function(t){this.filterList[t].filter=""},handleFilter:function(){this.filterList.push({switchProp:{},filter:"",params:[],form:"",to:""})},delRow:function(t){this.filterList.splice(t,1)},handleUpdate:function(t){this.filterList=t},handleBtnVal:function(t){this.btnVal=t}}},d=v,p=a("2877"),b=Object(p["a"])(d,n,i,!1,null,null,null);e["default"]=b.exports}}]);