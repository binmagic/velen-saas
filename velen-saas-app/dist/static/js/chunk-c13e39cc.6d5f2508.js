(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c13e39cc"],{"2dc4":function(t,e,a){t.exports={menuText:"#bfcbd9",menuActiveText:"#409EFF",subMenuActiveText:"#f4f4f5",menuBg:"#304156",menuHover:"#263445",subMenuBg:"#1f2d3d",subMenuHover:"#001528",sideBarWidth:"210px"}},"52d7":function(t,e,a){"use strict";a.d(e,"a",(function(){return i}));var n=a("b775");function i(t){return Object(n["a"])({url:"/query/report",method:"post",data:t})}},ed63:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container"},[a("custom-header",{attrs:{"show-name":t.$route.meta.title}},[a("div",{attrs:{slot:"tools"},slot:"tools"},[a("el-popover",{attrs:{placement:"bottom",width:"200",trigger:"click"},on:{show:t.handleCleanData},model:{value:t.popoverVisible,callback:function(e){t.popoverVisible=e},expression:"popoverVisible"}},[a("el-button",{attrs:{slot:"reference",icon:"el-icon-folder-add"},slot:"reference"}),t._v(" "),a("el-form",{attrs:{model:t.formData}},[a("el-form-item",{attrs:{label:"书签名"}},[a("el-input",{model:{value:t.formData.name,callback:function(e){t.$set(t.formData,"name",e)},expression:"formData.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"备注"}},[a("el-input",{attrs:{type:"textarea"},model:{value:t.formData.comment,callback:function(e){t.$set(t.formData,"comment",e)},expression:"formData.comment"}})],1),t._v(" "),a("el-form-item",[a("el-button",{on:{click:function(e){t.popoverVisible=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.submitData}},[t._v("确定")])],1)],1)],1)],1)]),t._v(" "),a("el-container",{staticClass:"main"},[a("el-header",{staticClass:"meta-event-header"},[a("div",{staticStyle:{position:"relative"}},[a("el-row",[a("el-col",{staticStyle:{height:"40px"},attrs:{span:24}},[a("span",[t._v("元事件")]),t._v(" "),a("el-select",{attrs:{size:"small"},on:{change:t.handleSelectEvent},model:{value:t.switchEvent,callback:function(e){t.switchEvent=e},expression:"switchEvent"}},t._l(t.meta_events,(function(t){return a("el-option",{key:t.id,attrs:{label:t.showName,value:t.id}})})),1),t._v(" "),t.filterList.length>=1?a("span",[t._v("的")]):t._e(),t._v(" "),a("el-button",{staticClass:"meta-event-button",attrs:{type:"text",icon:"el-icon-plus"},on:{click:t.handleFilter}},[t._v("筛选条件\n              ")])],1)],1),t._v(" "),a("screening-condition",{attrs:{filter:t.filterList,props:t.meta_props},on:{"update:filter":function(e){t.filterList=e},"update-filter":t.handleUpdate,"get-btn-val":t.handleBtnVal}})],1)]),t._v(" "),a("el-main",[a("el-row",{staticStyle:{display:"flex","align-items":"center"}},[a("el-col",{attrs:{span:8}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},model:{value:t.originQuery.dateRange,callback:function(e){t.$set(t.originQuery,"dateRange",e)},expression:"originQuery.dateRange"}})],1),t._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:8}},[a("h4",[t._v(t._s(t.getMetaEventName()))])]),t._v(" "),a("el-col",{attrs:{span:8}})],1),t._v(" "),a("custom-table",{attrs:{columns:t.columns,value:t.data,total:t.total,loading:t.loading},on:{"update:columns":function(e){t.columns=e},"update:value":function(e){t.data=e},"update:total":function(e){t.total=e},"update:loading":function(e){t.loading=e},fetch:t.fetchData}})],1)],1)],1)},i=[],s=(a("db97"),a("7f7f"),a("7514"),a("2dc4"),a("2b74")),o=a("bc5d"),r=a("1c15"),l=a("52d7"),c=a("f670"),u=a("7d99"),m=a("75fb"),f=a("7c5d"),h={components:{CustomTable:s["a"],CustomHeader:o["a"],CustomCharts:r["a"],TagInput:f["a"],ScreeningCondition:c["a"]},data:function(){return{id:"",columns:[],data:[],total:0,loading:!1,switchEvent:"",filterValue:"",btnVal:"",filterList:[],meta_events:[],meta_props:{},params:"",query:{subTaskType:"META_EVENT",measures:{props:[],filter:{union:"AND",conditions:[]},page:1,limit:10}},originQuery:{dateRange:[]},formData:{name:"",comment:""},saveData:{data:"",name:"",config:"",type:"/meta_event_analytics/"},chartName:"测试",popoverVisible:!1}},created:function(){this.fetchMetaEventProps(),this.fetchMetaEvent()},methods:{submitData:function(){var t=this,e={};if(this.filterList.length>=1){var a=[];this.filterList.some((function(e){a.push({field:t.meta_events.find((function(a){return t.switchEvent===a.id?t.meta_events.name+"."+e.name:""})),function:e.filter,params:e.params})})),e["condition"]=a,this.filterList.length>1&&(e["relation"]=this.btnVal)}this.saveData.name=this.formData.name,this.saveData.config=JSON.stringify({comment:this.comment}),this.saveData.data=JSON.stringify(this.query),Object(m["b"])(this.saveData).then((function(e){t.id=e.id,t.$message.success("添加成功")})),this.popoverVisible=!1},fetchData:function(t){var e=this;console.log("fetchData"),this.loading=!0;var a=Object.assign({},this.query);a.measures=Object.assign({},a.measures,t);var n=this;Object(l["a"])(a).then((function(t){var a=[];for(var i in t.rows){var s=t.rows[i],o={};for(var r in s)o[r.toLowerCase()]=s[r];a.push(o)}e.data=a,e.total=t.total||t.rows.length,setTimeout((function(){n.loading=!1}),1e3)})).catch((function(t){e.loading=!1}))},fetchMetaEventProps:function(){var t=this;Object(u["f"])().then((function(e){for(var a in e.items)t.meta_props[e.items[a].id]=e.items[a]}))},fetchMetaEvent:function(){var t=this;Object(u["e"])().then((function(e){t.meta_events=e.items}))},handleSelectEvent:function(){var t=[];for(var e in this.meta_events){var a=this.meta_events[e];if(Object.is(a.id,this.switchEvent)){t=a.propIds;break}}this.handleColumn(t),this.fetchData()},handleColumn:function(t){for(var e in this.columns.length=0,this.query.measures.props=[],t){var a=this.meta_props[t[e]];a&&(this.columns.push({prop:a.name.toLowerCase(),label:a.showName}),this.query.measures.props.push(a.name))}this.query.measures.eventName=this.switchEvent},getMetaEventName:function(){for(var t in this.meta_events){var e=this.meta_events[t];if(Object.is(e.id,this.switchEvent))return e.showName}},handleInput:function(t){},handleSelectChange:function(t){this.filterList[t].filter=""},handleFilter:function(){this.filterList.push({switchProp:{},filter:"",params:[],form:"",to:""})},delRow:function(t){this.filterList.splice(t,1)},handleUpdate:function(t){for(var e in this.filterList=t,this.query.measures.filter.conditions=[],this.filterList){var a=this.filterList[e];this.query.measures.filter.conditions.push({prop:a.switchProp.name,filter:a.filter,params:a.params})}this.fetchData()},handleBtnVal:function(t){this.btnVal=t},handleCleanData:function(){this.formData.name="",this.formData.comment=""}}},p=h,d=a("2877"),v=Object(d["a"])(p,n,i,!1,null,null,null);e["default"]=v.exports}}]);